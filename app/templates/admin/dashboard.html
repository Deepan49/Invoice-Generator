{% extends "admin/base_admin.html" %}

{% block admin_content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Platform Overview</h2>
        <div class="text-muted">Last updated: {{ now }}</div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="bg-primary bg-opacity-10 p-3 rounded-circle me-3">
                        <i class="bi bi-people text-primary fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Total Users</div>
                        <div class="h4 fw-bold mb-0">{{ stats.total_users }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="bg-success bg-opacity-10 p-3 rounded-circle me-3">
                        <i class="bi bi-currency-dollar text-success fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Total Revenue</div>
                        <div class="h4 fw-bold mb-0">${{ "{:,.2f}".format(stats.total_revenue) }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="bg-info bg-opacity-10 p-3 rounded-circle me-3">
                        <i class="bi bi-building text-info fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Organizations</div>
                        <div class="h4 fw-bold mb-0">{{ stats.total_orgs }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="d-flex align-items-center">
                    <div class="bg-warning bg-opacity-10 p-3 rounded-circle me-3">
                        <i class="bi bi-star text-warning fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">Active Subscriptions</div>
                        <div class="h4 fw-bold mb-0">{{ stats.active_subscriptions }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Chart -->
    <div class="row">
        <div class="col-md-8">
            <div class="card border-0 shadow-sm p-4">
                <h5 class="mb-4">Revenue Growth (Last 6 Months)</h5>
                <canvas id="revenueChart" height="300" data-chart="{{ chart_data | tojson | safe }}"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm p-4 h-100">
                <h5 class="mb-4">Recent Growth</h5>
                <div class="mb-3">
                    <div class="text-muted small">New Users (7d)</div>
                    <div class="h4 fw-bold">{{ stats.new_users_week }}</div>
                </div>
                <div class="progress mb-4" style="height: 10px;">
                    <div class="progress-bar" style="width: 75%"></div>
                </div>
                <p class="text-muted small">Platform activity is up 12% compared to last week.</p>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const canvas = document.getElementById('revenueChart');
    const ctx = canvas.getContext('2d');
    const chartData = JSON.parse(canvas.dataset.chart);

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartData.map(d => d.label),
            datasets: [{
                label: 'Monthly Paid Revenue ($)',
                data: chartData.map(d => d.value),
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}